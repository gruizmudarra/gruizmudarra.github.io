---
import { getCollection } from "astro:content";
import PostCard from "./PostCard.astro";

// Get all pinned blog posts
const pinnedPosts = await getCollection("blog", ({ data }) => {
    return data.pinned === true;
});

// Sort by publication date (newest first)
pinnedPosts.sort(
    (a, b) =>
        new Date(b.data.pubDate || 0).valueOf() -
        new Date(a.data.pubDate || 0).valueOf(),
);
---

<section class="mb-12">
    <h2 class="text-3xl font-bold mb-6 text-center">Posts Destacados</h2>

    {
        pinnedPosts.length > 0 ? (
            <div class="relative">
                <div class="overflow-hidden">
                    <ul
                        class="flex transition-transform duration-300 ease-in-out p-0 m-0"
                        id="carousel-track"
                    >
                        {pinnedPosts.map((post) => (
                            <PostCard
                                post={post}
                                class="carousel-slide flex-shrink-0 w-full md:w-1/2 lg:w-1/3 px-4"
                                showPinnedLabel={false}
                            />
                        ))}
                    </ul>
                </div>

                {pinnedPosts.length > 1 && (
                    <>
                        <div class="hidden md:flex justify-center mt-6 space-x-2">
                            <button
                                id="prev-btn"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                aria-label="Anterior"
                            >
                                <svg
                                    class="w-5 h-5"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M15 19l-7-7 7-7"
                                    />
                                </svg>
                            </button>
                            <button
                                id="next-btn"
                                class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-2 px-4 rounded-full transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
                                aria-label="Siguiente"
                            >
                                <svg
                                    class="w-5 h-5"
                                    fill="none"
                                    stroke="currentColor"
                                    viewBox="0 0 24 24"
                                >
                                    <path
                                        stroke-linecap="round"
                                        stroke-linejoin="round"
                                        stroke-width="2"
                                        d="M9 5l7 7-7 7"
                                    />
                                </svg>
                            </button>
                        </div>
                        <div
                            class="flex justify-center mt-4 space-x-2"
                            id="dots-container"
                        >
                            {Array.from({
                                length: Math.ceil(pinnedPosts.length / 3),
                            }).map((_, index) => (
                                <button
                                    class="dot w-3 h-3 rounded-full bg-gray-300 hover:bg-gray-400 transition-colors"
                                    data-slide={index}
                                    aria-label={`Ir a pÃ¡gina de slides ${index + 1}`}
                                />
                            ))}
                        </div>
                    </>
                )}
            </div>
        ) : (
            <div class="text-center text-gray-500 py-12">
                <p class="text-lg">No hay posts destacados disponibles.</p>
            </div>
        )
    }
</section>

<script src="/src/components/carousel.ts" is:inline></script>

<style>
    .carousel-slide {
        list-style: none;
    }
    .dot.bg-blue-600 {
        background-color: #2563eb;
    }

    .line-clamp-2 {
        display: -webkit-box;
        -webkit-box-orient: vertical;
        -webkit-line-clamp: 2;
        overflow: hidden;
    }
</style>
