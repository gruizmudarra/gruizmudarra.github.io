---
import { Icon } from "astro-icon/components";
import { SITE_TITLE } from "../consts";

export interface Props {
	transparent?: boolean;
}

const { transparent = false } = Astro.props;

const pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
const subpath = pathname.match(/[^\/]+/g);

function isActive(href: string): boolean {
	return href === pathname || href === "/" + (subpath?.[0] || "");
}
---

<header
	data-header
	data-transparent={transparent}
	class:list={[
		"fixed top-0 left-0 w-full z-50 transition-all duration-300",
		transparent ? "bg-transparent" : "bg-black/80 backdrop-blur-md shadow-lg",
	]}
>
	<nav class="max-w-5xl mx-auto flex items-center justify-between px-4 h-16">
		<!-- Logo -->
		<a href="/" class="no-underline text-white font-bold text-lg tracking-tight font-['Space_Mono',monospace]">
			<span class="text-accent-secondary">&gt;</span> {SITE_TITLE}
		</a>

		<!-- Desktop links -->
		<div class="hidden md:flex items-center gap-8">
			<a
				href="/"
				class:list={[
					"relative py-1 text-sm font-medium no-underline text-white/80 transition-colors duration-200 hover:text-white",
					"after:absolute after:bottom-0 after:left-0 after:h-0.5 after:bg-accent-secondary after:transition-all after:duration-300",
					isActive("/") ? "text-white after:w-full" : "after:w-0 hover:after:w-full",
				]}
			>
				Inicio
			</a>
			<a
				href="/blog"
				class:list={[
					"relative py-1 text-sm font-medium no-underline text-white/80 transition-colors duration-200 hover:text-white",
					"after:absolute after:bottom-0 after:left-0 after:h-0.5 after:bg-accent-secondary after:transition-all after:duration-300",
					isActive("/blog") ? "text-white after:w-full" : "after:w-0 hover:after:w-full",
				]}
			>
				Blog
			</a>

			<!-- Social icons -->
			<div class="flex items-center gap-3 ml-4 border-l border-white/20 pl-4">
				<a
					href="https://github.com/grmnlabs"
					target="_blank"
					rel="noopener noreferrer"
					class="flex text-white/60 no-underline hover:text-white transition-colors duration-200"
				>
					<Icon name="mdi:github" width={20} height={20} />
				</a>
				<a
					href="https://linkedin.com/in/gruizmudarra"
					target="_blank"
					rel="noopener noreferrer"
					class="flex text-white/60 no-underline hover:text-white transition-colors duration-200"
				>
					<Icon name="mdi:linkedin" width={20} height={20} />
				</a>
			</div>
		</div>

		<!-- Mobile hamburger -->
		<button
			data-menu-toggle
			class="md:hidden flex items-center justify-center w-10 h-10 text-white bg-transparent border-none cursor-pointer"
			aria-label="Abrir menú"
		>
			<Icon name="mdi:menu" width={28} height={28} class="menu-icon-open" />
			<Icon name="mdi:close" width={28} height={28} class="menu-icon-close hidden" />
		</button>
	</nav>

	<!-- Mobile overlay menu -->
	<div
		data-mobile-menu
		class="fixed inset-0 bg-black/95 backdrop-blur-md flex flex-col items-center justify-center gap-8
			translate-x-full transition-transform duration-300 ease-in-out md:hidden"
	>
		<a
			href="/"
			class:list={[
				"text-2xl font-bold no-underline transition-colors duration-200",
				isActive("/") ? "text-accent-secondary" : "text-white hover:text-accent-secondary",
			]}
		>
			Inicio
		</a>
		<a
			href="/blog"
			class:list={[
				"text-2xl font-bold no-underline transition-colors duration-200",
				isActive("/blog") ? "text-accent-secondary" : "text-white hover:text-accent-secondary",
			]}
		>
			Blog
		</a>

		<div class="flex items-center gap-6 mt-4">
			<a
				href="https://github.com/grmnlabs"
				target="_blank"
				rel="noopener noreferrer"
				class="flex text-white/70 no-underline hover:text-white transition-colors duration-200"
			>
				<Icon name="mdi:github" width={28} height={28} />
			</a>
			<a
				href="https://linkedin.com/in/gruizmudarra"
				target="_blank"
				rel="noopener noreferrer"
				class="flex text-white/70 no-underline hover:text-white transition-colors duration-200"
			>
				<Icon name="mdi:linkedin" width={28} height={28} />
			</a>
		</div>
	</div>
</header>

<script>
	const header = document.querySelector("[data-header]") as HTMLElement;
	const toggle = document.querySelector("[data-menu-toggle]") as HTMLElement;
	const menu = document.querySelector("[data-mobile-menu]") as HTMLElement;
	const iconOpen = header.querySelector(".menu-icon-open") as HTMLElement;
	const iconClose = header.querySelector(".menu-icon-close") as HTMLElement;
	const isTransparent = header.dataset.transparent === "true";

	// Scroll detection — only relevant on transparent pages (landing)
	if (isTransparent) {
		let ticking = false;
		window.addEventListener("scroll", () => {
			if (!ticking) {
				requestAnimationFrame(() => {
					const scrolled = window.scrollY > 50;
					header.classList.toggle("bg-transparent", !scrolled);
					header.classList.toggle("bg-black/80", scrolled);
					header.classList.toggle("backdrop-blur-md", scrolled);
					header.classList.toggle("shadow-lg", scrolled);
					ticking = false;
				});
				ticking = true;
			}
		});
	}

	// Mobile menu toggle
	toggle.addEventListener("click", () => {
		const isOpen = menu.classList.toggle("translate-x-0");
		menu.classList.toggle("translate-x-full", !isOpen);
		iconOpen.classList.toggle("hidden", isOpen);
		iconClose.classList.toggle("hidden", !isOpen);
		document.body.classList.toggle("overflow-hidden", isOpen);
		toggle.setAttribute("aria-label", isOpen ? "Cerrar menú" : "Abrir menú");
	});

	// Close mobile menu on link click
	menu.querySelectorAll("a").forEach((link) => {
		link.addEventListener("click", () => {
			menu.classList.remove("translate-x-0");
			menu.classList.add("translate-x-full");
			iconOpen.classList.remove("hidden");
			iconClose.classList.add("hidden");
			document.body.classList.remove("overflow-hidden");
			toggle.setAttribute("aria-label", "Abrir menú");
		});
	});
</script>
