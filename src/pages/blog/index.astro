---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import { Image } from "astro:assets";

const posts = (await getCollection("blog")).sort((a, b) => {
    // First, prioritize pinned posts
    if (a.data.pinned && !b.data.pinned) return -1;
    if (!a.data.pinned && b.data.pinned) return 1;

    // Then sort by pubDate (newest first)
    return (b.data.pubDate?.valueOf() ?? 0) - (a.data.pubDate?.valueOf() ?? 0);
});
---

<BaseLayout>
    <section class="mx-auto max-w-[80ch] px-4 py-8">
        <ul class="m-0 flex flex-wrap gap-8 p-0 md:gap-2">
            {
                posts.map((post, index) => (
                    <li
                        class={`${index === 0 ? "mb-4 w-full text-center" : "w-full text-center md:w-[calc(50%-0.5rem)]"}`}
                    >
                        <a
                            href={`/blog/${post.id}/`}
                            class="group block transition-all duration-200 ease-in-out"
                        >
                            <div class="relative">
                                {post.data.heroImage && (
                                    <Image
                                        width={1024}
                                        height={512}
                                        src={post.data.heroImage}
                                        alt=""
                                        class="mb-2 rounded-xl transition-all duration-200 group-hover:shadow-[var(--box-shadow)]"
                                    />
                                )}
                                {post.data.pinned && (
                                    <span class="absolute right-4 top-4 rounded bg-accent/10 px-2.5 py-0.5 text-sm font-medium text-accent shadow-lg">
                                        Destacado
                                    </span>
                                )}
                            </div>
                            <h4
                                class={`m-0 leading-none text-black transition-colors duration-200 group-hover:text-accent ${index === 0 ? "text-4xl md:text-2xl" : ""}`}
                            >
                                {post.data.title}
                            </h4>
                            <p class="m-0 text-gray transition-colors duration-200 group-hover:text-accent">
                                {post.data.pubDate && (
                                    <FormattedDate date={post.data.pubDate} />
                                )}
                            </p>
                        </a>
                    </li>
                ))
            }
        </ul>
    </section>
</BaseLayout>
